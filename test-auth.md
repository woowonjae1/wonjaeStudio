# 认证系统测试指南

## 🧪 测试登录系统

### 1. 快速测试流程

#### 步骤 1：启动项目
```bash
npm run dev
```

#### 步骤 2：访问注册页面
- 打开浏览器访问：http://localhost:3000/auth/register
- 填写测试信息：
  - 用户名：Test User
  - 邮箱：test@example.com
  - 密码：test123456

#### 步骤 3：确认邮箱（开发环境）
- 如果配置了 Supabase，去 Supabase Dashboard > Authentication > Users
- 找到你的用户，点击右侧三点菜单
- 选择 "Confirm user" 手动确认

#### 步骤 4：登录
- 访问：http://localhost:3000/auth/login
- 使用刚才的邮箱和密码登录
- 成功后会跳转到 /dashboard

#### 步骤 5：测试功能
1. **查看个人面板**：应该显示用户信息
2. **测试收藏**：回到首页，点击任意专辑的收藏按钮
3. **测试评论**：在专辑下方发表评论
4. **查看数据**：返回 dashboard 查看收藏和历史

### 2. 测试各个页面

#### ✅ 可以直接访问的页面
- `/` - 首页（未登录也可访问）
- `/home` - 主页（未登录也可访问）
- `/auth/login` - 登录页
- `/auth/register` - 注册页

#### 🔒 需要登录的页面
- `/dashboard` - 个人面板（未登录会重定向到 /auth/login）

### 3. 检查认证状态

#### 在任意页面使用浏览器控制台：
```javascript
// 查看当前登录状态
// 打开浏览器开发者工具 > Console
// 输入：
localStorage.getItem('supabase.auth.token')
```

如果返回内容，说明已登录；如果返回 null，说明未登录。

### 4. 功能清单

#### ✅ 已实现的功能
- [x] 用户注册（邮箱+密码）
- [x] 用户登录（邮箱+密码）
- [x] 社交登录按钮（Google/GitHub - 需配置）
- [x] 用户登出
- [x] 个人资料展示
- [x] 收藏功能
- [x] 评论功能
- [x] 播放历史记录
- [x] Header 显示登录状态

#### 🔄 需要手动测试的功能
1. **注册流程**
   - 填写表单
   - 接收确认邮件（或手动确认）
   - 登录账号

2. **登录流程**
   - 邮箱密码登录
   - 错误提示
   - 成功跳转

3. **收藏功能**
   - 点击收藏按钮
   - 按钮状态变化
   - Dashboard 显示收藏

4. **评论功能**
   - 发表评论
   - 实时显示
   - 删除自己的评论

5. **权限控制**
   - 未登录访问 /dashboard → 重定向到登录页
   - 已登录访问 /auth/login → 可以再次登录或跳转

### 5. 调试技巧

#### 查看 Supabase 请求
打开浏览器开发者工具 > Network：
- 过滤：`supabase`
- 查看请求和响应

#### 查看认证错误
在代码中添加 console.log：
```typescript
// 在 useAuth.ts 或登录组件中
console.log('User:', user);
console.log('Error:', error);
```

#### 重置测试数据
在 Supabase Dashboard：
1. Table Editor > 选择表
2. 删除测试数据
3. 重新测试

### 6. 常见测试问题

#### 问题 1：注册后无法登录
- 检查：用户是否已确认邮箱
- 解决：在 Supabase 手动确认用户

#### 问题 2：收藏按钮不工作
- 检查：是否已登录
- 检查：浏览器控制台是否有错误
- 解决：确保 RLS 策略已正确设置

#### 问题 3：评论无法显示
- 检查：数据库是否有 comments 表
- 检查：是否运行了 supabase-setup.sql
- 解决：重新运行 SQL 脚本

#### 问题 4：页面显示 "Missing environment variables"
- 检查：.env.local 文件是否存在
- 检查：环境变量名称是否正确
- 解决：重启开发服务器（npm run dev）

### 7. 生产环境测试

部署后测试清单：
- [ ] 注册新用户
- [ ] 接收确认邮件
- [ ] 登录成功
- [ ] 收藏功能正常
- [ ] 评论功能正常
- [ ] 社交登录（如已配置）
- [ ] 登出功能
- [ ] 权限控制正确

## 🎯 下一步

测试完成后，你可以：
1. 迁移现有数据到 Supabase
2. 自定义用户界面
3. 添加更多社交功能（点赞、分享等）
4. 优化性能和用户体验

